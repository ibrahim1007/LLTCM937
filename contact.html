<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - LEODRA</title>
    <!-- Tailwind CSS CDN for utility-first styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- Google Fonts - Inter for consistent typography -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Custom CSS for font-family and responsive font sizes using clamp */
      body {
        font-family: "Inter", sans-serif;
        overflow-x: hidden; /* Prevent horizontal scroll on smaller screens */
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        background-color: #fdfdfd;
        color: #000000;
      }

      /* Styles copied from index.html for header consistency */
      /* Hamburger menu bar animation */
      .menu-icon .bar {
        /* Added .menu-icon to target bars directly */
        transition: all 0.3s ease-in-out;
      }
      .menu-icon.open .bar:nth-child(1) {
        transform: translateY(7px) rotate(45deg);
      }
      .menu-icon.open .bar:nth-child(2) {
        opacity: 0;
      }
      .menu-icon.open .bar:nth-child(3) {
        transform: translateY(-7px) rotate(-45deg);
      }

      /* Mobile navigation overlay */
      .mobile-nav-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        /* DIHAPUS: background: rgba(0, 0, 0, 0.95); */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999;
        transform: translateX(100%);
        transition: transform 0.3s ease-in-out;
      }

      .mobile-nav-overlay.open {
        transform: translateX(0);
      }

      .mobile-nav-overlay ul {
        list-style: none;
        padding: 0;
        text-align: center;
      }

      .mobile-nav-overlay ul li {
        margin: 16px 0; /* Adjusted margin for better spacing */
      }

      .mobile-nav-overlay ul li a {
        color: black; /* DIUBAH: dari 'white' ke 'black' */
        font-size: 1.6rem; /* Adjusted font size for mobile menu links */
        text-decoration: none;
        font-weight: 500;
      }

      /* Styles for search input in header (copied from index.html) */
      .search-input {
        width: 140px; /* Slightly wider for better usability */
        padding: 6px 10px; /* Increased padding */
        border-radius: 6px; /* More rounded corners */
        border: 1px solid #ccc;
        font-size: 0.875rem; /* text-sm */
        color: #333;
        transition: width 0.3s ease-in-out, border-color 0.2s ease-in-out,
          box-shadow 0.2s ease-in-out;
        background-color: #f8f8f8; /* Lighter background for better contrast */
      }

      .search-input:focus {
        width: 200px; /* Expand on focus */
        outline: none;
        border-color: #555; /* Darker border on focus */
        box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.2); /* Subtle shadow on focus */
      }

      .search-button {
        background-color: #eee; /* Diubah dari #333 (hitam) ke abu-abu muda */
        color: #333; /* Diubah dari white ke #333 (hitam/gelap) */
        padding: 6px 12px; /* Increased padding */
        border-radius: 6px; /* More rounded corners */
        font-size: 0.875rem; /* text-sm */
        cursor: pointer;
        transition: background-color 0.2s ease-in-out,
          transform 0.1s ease-in-out;
      }

      .search-button:hover {
        background-color: #ddd; /* Diubah dari #555 ke abu-abu lebih gelap */
        transform: translateY(-1px); /* Slight lift on hover */
      }
      .search-button:active {
        transform: translateY(0); /* Press effect */
      }

      /* Message Modal specific styles (copied from index.html) */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
      }

      .modal-overlay.open {
        opacity: 1;
        visibility: visible;
      }

      .modal-content {
        background-color: white;
        padding: 2.5rem; /* Increased padding */
        border-radius: 0.75rem; /* More rounded corners */
        box-shadow: 0 15px 25px rgba(0, 0, 0, 0.3); /* Stronger shadow */
        max-width: 90%;
        width: 500px; /* Slightly wider modal */
        position: relative;
        transform: translateY(-30px); /* More pronounced initial transform */
        transition: transform 0.3s ease-in-out;
      }

      .modal-overlay.open .modal-content {
        transform: translateY(0);
      }

      .btn-primary {
        background-color: #000000; /* Black */
        color: #ffffff; /* White */
        padding: 12px 24px; /* Increased padding */
        border-radius: 6px; /* More rounded corners */
        font-weight: 600; /* Semi-bold */
        transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out,
          transform 0.1s ease-in-out;
        cursor: pointer;
      }
      .btn-primary:hover {
        background-color: #333; /* Darker black on hover */
        transform: translateY(-1px); /* Slight lift on hover */
      }
      .btn-primary:active {
        transform: translateY(0); /* Press effect */
      }
      .btn-primary:disabled {
        background-color: #999;
        cursor: not-allowed;
      }

      /* Responsive font sizes using clamp for main titles */
      .text-h1-responsive {
        font-size: clamp(2rem, 6vw, 2.8rem); /* Larger for impact */
        letter-spacing: -0.02em;
        font-weight: 300;
      }
      .text-h2-responsive {
        font-size: clamp(1.2rem, 3.5vw, 1.8rem);
      }
      .text-h3-responsive {
        font-size: clamp(1rem, 3vw, 1.5rem);
      }
      .text-h4-responsive {
        font-size: clamp(0.9rem, 2vw, 1.2rem);
      }
      .text-p-responsive {
        font-size: clamp(0.8rem, 1.6vw, 1rem);
        font-weight: 300;
      }

      /* Scroll Animation Styles */
      /* Initial state: hidden and slightly moved down */
      .scroll-animate {
        opacity: 0;
        transform: translateY(
          30px
        ); /* Increased initial translation for more noticeable slide */
        /* Changed transition to be longer and use ease-in-out for smoother effect */
        transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
      }

      /* Animated state: visible and in original position */
      .scroll-animate.is-visible {
        opacity: 1;
        transform: translateY(0);
      }
      /* Make Google sign-in button wider and responsive */
      .g_id_signin {
        display: inline-block;
        width: 100%;
        max-width: 420px; /* adjust the max width as needed */
        margin-left: auto;
        margin-right: auto;
        text-align: center;
      }
      /* Force inner Google button/iframe to fill the container */
      .g_id_signin > div,
      .g_id_signin iframe,
      .g_id_signin button {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
      }
    </style>
  </head>
  <body>
    <!-- Message Modal -->
    <div
      id="messageModal"
      class="modal-overlay"
      role="dialog"
      aria-modal="true"
      aria-labelledby="messageModalTitle"
    >
      <div class="modal-content">
        <div class="flex justify-between items-center mb-6">
          <h3
            id="messageModalTitle"
            class="text-h3-responsive font-semibold text-gray-800"
          >
            Pesan
          </h3>
          <button
            onclick="closeMessageModal()"
            class="text-gray-500 hover:text-gray-700 text-3xl font-bold leading-none"
            aria-label="Tutup pesan"
          >
            &times;
          </button>
        </div>
        <div
          id="messageModalContent"
          class="text-p-responsive text-center text-gray-700 space-y-3 mb-8"
        >
          <!-- Message will be inserted here by JavaScript -->
        </div>
        <div class="flex justify-center">
          <button onclick="closeMessageModal()" class="btn-primary px-10">
            Tutup
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Navigation Overlay (Hidden by default) -->
    <div
      id="mobile-nav-overlay"
      class="mobile-nav-overlay md:hidden bg-white/80 backdrop-blur-lg" /* DITAMBAHKAN: bg-white/80 backdrop-blur-lg */
      role="navigation"
      aria-label="Menu Mobile"
    >
      <button
        class="absolute top-4 right-4 cursor-pointer text-black text-3xl" /* DIUBAH: dari 'text-white' ke 'text-black' */
        onclick="toggleMobileMenu()"
        aria-label="Tutup menu mobile"
      >
        &times;
      </button>
      <div class="flex items-center mb-6">
        <input
          type="text"
          id="mobile-search-input"
          placeholder="Cari halaman..."
          class="search-input mr-3"
          aria-label="Cari halaman"
        />
        <button
          onclick="performSearch('mobile-search-input')"
          class="search-button"
          aria-label="Tombol Cari"
        >
          Cari
        </button>
      </div>
      <ul>
        <li>
          <a
            href="index.html"
            class="hover:text-gray-600 transition-colors duration-200" /* DIUBAH: 'text-white hover:text-gray-300' dihapus/diubah */
            onclick="toggleMobileMenu()"
            >Home</a
          >
        </li>
        <li>
          <a
            href="about_new.html"
            class="hover:text-gray-600 transition-colors duration-200" /* DIUBAH: 'text-white hover:text-gray-300' dihapus/diubah */
            onclick="toggleMobileMenu()"
            >About</a
          >
        </li>
        <li>
          <a
            href="services.html"
            class="hover:text-gray-600 transition-colors duration-200" /* DIUBAH: 'text-white hover:text-gray-300' dihapus/diubah */
            onclick="toggleMobileMenu()"
            >Services</a
          >
        </li>
        <li>
          <a
            href="contact.html"
            class="hover:text-gray-600 transition-colors duration-200" /* DIUBAH: 'text-white hover:text-gray-300' dihapus/diubah */
            onclick="toggleMobileMenu()"
            >Contact</a
          >
        </li>
      </ul>
    </div>

    <!-- Header Section -->
    <!-- PERUBAHAN: Latar belakang diubah ke putih transparan + blur, teks diubah ke hitam -->
    <header
      class="bg-white/80 backdrop-blur-lg h-16 flex items-center sticky top-0 z-50 w-full shadow-md border-b border-gray-200/50"
    >
      <div
        class="container mx-auto flex justify-end md:justify-between items-center px-4 sm:px-6 lg:px-8 w-full relative"
      >
        <div
          class="absolute left-1/2 -translate-x-1/2 md:static md:transform-none text-black text-2xl font-thin"
          style="font-family: 'Century Schoolbook', serif"
        >
          LEODRA
        </div>
        <!-- Hamburger Menu Icon for Mobile -->
        <button
          class="md:hidden menu-icon w-8 h-8 flex flex-col justify-around cursor-pointer p-1 rounded-sm transition-all duration-300 ease-in-out"
          onclick="toggleMobileMenu()"
          aria-label="Buka menu mobile"
        >
          <div class="bar w-full h-0.5 bg-black rounded-full"></div>
          <div class="bar w-full h-0.5 bg-black rounded-full"></div>
          <div class="bar w-full h-0.5 bg-black rounded-full"></div>
        </button>
        <!-- Desktop Navigation Links -->
        <nav
          class="hidden md:flex items-center space-x-6"
          aria-label="Menu Utama"
        >
          <div class="flex items-center space-x-3">
            <input
              type="text"
              id="desktop-search-input"
              placeholder="Cari halaman..."
              class="search-input"
              aria-label="Cari halaman"
            />
            <button
              onclick="performSearch('desktop-search-input')"
              class="search-button"
              aria-label="Tombol Cari"
            >
              Cari
            </button>
          </div>
          <ul class="flex space-x-6">
            <li>
              <a
                href="index.html"
                class="text-black text-sm font-normal hover:text-gray-600 transition-colors duration-200"
                >Home</a
              >
            </li>
            <li>
              <a
                href="about_new.html"
                class="text-black text-sm font-normal hover:text-gray-600 transition-colors duration-200"
                >About</a
              >
            </li>
            <li>
              <a
                href="services.html"
                class="text-black text-sm font-normal hover:text-gray-600 transition-colors duration-200"
                >Services</a
              >
            </li>
            <li>
              <a
                href="contact.html"
                class="text-black text-sm font-normal hover:text-gray-600 transition-colors duration-200"
                >Contact</a
              >
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- Main content for the Login page -->
    <main class="flex-grow flex flex-col items-center justify-center p-8">
      <section
        class="container mx-auto px-3 sm:px-5 lg:px-6 max-w-4xl py-8 md:py-14 w-full"
      >
        <h1
          class="text-h1-responsive text-black text-center mb-10 scroll-animate"
        >
          Akses Akun Anda
        </h1>

        <!-- Login Section -->
        <div
          class="w-full max-w-md bg-white p-6 md:p-8 rounded-lg shadow-lg mx-auto scroll-animate"
        >
          <!-- User info when already logged in -->
          <div id="user-info" class="hidden">
            <h3
              class="text-h3-responsive text-black font-semibold mb-4 text-center"
            >
              Anda sudah masuk
            </h3>
            <p id="user-email" class="text-center text-gray-700 mb-4"></p>
            <div class="flex justify-center">
              <button
                id="logout-button"
                class="btn-primary px-8 py-3 bg-gray-600 hover:bg-gray-700"
              >
                Keluar
              </button>
            </div>
          </div>

          <!-- Formulir Pra-Otentikasi Sandi "dewi" -->
          <div id="pre-auth-form" class="hidden">
            <h3
              class="text-h3-responsive text-black font-semibold mb-6 text-center"
            >
              Verifikasi Awal
            </h3>
            <div class="flex flex-col items-center space-y-4">
              <input
                type="password"
                id="pre-auth-sandi"
                placeholder="Masukkan Sandi Verifikasi..."
                class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-black focus:border-black text-p-responsive text-center"
                autocomplete="current-password"
              />
              <button
                id="pre-auth-button"
                onclick="handlePreAuth()"
                class="btn-primary px-8 py-3 w-full"
              >
                Lanjutkan
              </button>
            </div>
          </div>

          <!-- Login Form (PIN) -->
          <div id="login-form">
            <h3
              class="text-h3-responsive text-black font-semibold mb-6 text-center"
            >
              Selamat Datang Kembali
            </h3>
            <div class="flex flex-col items-center space-y-4">
              <input
                type="password"
                id="login-pin"
                placeholder="Masukkan 6 digit PIN Anda..."
                class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-black focus:border-black text-p-responsive tracking-widest text-center"
                maxlength="6"
                pattern="\d{6}"
                oninput="this.value=this.value.replace(/[^0-9]/g, '')"
                autocomplete="current-password"
              />
              <button
                id="login-button"
                onclick="loginUser()"
                class="btn-primary px-8 py-3 w-full"
              >
                Login
              </button>
            </div>
          </div>

          <!-- Google Sign-in Elements (Ditampilkan setelah lolos PIN) -->
          <div
            id="g_id_onload"
            data-client_id="978765192475-ei64dtk50k39agto3g9b70blg41av878.apps.googleusercontent.com"
            data-callback="handleCredentialResponse"
            data-auto_select="false"
            data-itp_support="true"
            class="py-4"
          ></div>

          <div
            class="g_id_signin"
            data-type="standard"
            data-shape="rectangular"
            data-theme="outline"
            data-text="signin_with"
            data-size="large"
            data-logo_alignment="left"
          ></div>
        </div>
      </section>
    </main>

    <!-- Footer Section (Copied from index.html for consistency) -->
    <!-- PERUBAHAN DIMULAI: Footer dirombak total agar terlihat profesional seperti Apple -->
    <footer class="bg-gray-100 py-10 md:py-16 mt-10 w-full scroll-animate">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-5xl text-xs text-gray-500">
            
            <!-- Bagian Legal/Disclaimer (opsional, meniru Apple) -->
            <div class="space-y-2 mb-8">
                <p>1. Perdagangan memiliki risiko. Kinerja masa lalu tidak menjamin hasil di masa depan. Informasi di situs ini hanya untuk tujuan edukasi.</p>
                <p>2. Beberapa fitur atau layanan mungkin tidak tersedia di semua wilayah atau bahasa. <a href="#" class="text-gray-600 underline hover:text-black">Selengkapnya...</a></p>
                <p>3. LEODRA tidak bertanggung jawab atas kerugian apa pun yang timbul dari penggunaan informasi di situs ini.</p>
            </div>

            <!-- Garis Pemisah -->
            <hr class="border-gray-300 mb-8">

            <!-- Sitemap Grid (5 Kolom) -->
            <div class="grid grid-cols-2 md:grid-cols-5 gap-8">
                
                <!-- Kolom 1 -->
                <div>
                    <h4 class="font-semibold text-gray-900 mb-3 text-sm">Layanan</h4>
                    <ul class="space-y-2">
                        <li><a href="services.html" class="text-gray-600 hover:text-black">Analisis Pasar</a></li>
                        <li><a href="services.html" class="text-gray-600 hover:text-black">Sinyal Perdagangan</a></li>
                        <li><a href="services.html" class="text-gray-600 hover:text-black">Edukasi</a></li>
                        <li><a href="services.html" class="text-gray-600 hover:text-black">Manajemen Akun</a></li>
                        <li><a href="services.html" class="text-gray-600 hover:text-black">Konsultasi</a></li>
                    </ul>
                </div>
                
                <!-- Kolom 2 -->
                <div>
                    <h4 class="font-semibold text-gray-900 mb-3 text-sm">Akun</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-600 hover:text-black">Kelola Akun Anda</a></li>
                        <li><a href="index.html" class="text-gray-600 hover:text-black">Masuk Anggota</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-black">Buka Akun Baru</a></li>
                    </ul>
                     <h4 class="font-semibold text-gray-900 mb-3 mt-6 text-sm">Platform</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-600 hover:text-black">MetaTrader 4</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-black">MetaTrader 5</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-black">WebTrader</a></li>
                    </ul>
                </div>

                <!-- Kolom 3 -->
                <div>
                    <h4 class="font-semibold text-gray-900 mb-3 text-sm">Untuk Bisnis</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-600 hover:text-black">Leodra dan Bisnis</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-black">Program Kemitraan</a></li>
                    </ul>
                    <h4 class="font-semibold text-gray-900 mb-3 mt-6 text-sm">Untuk Institusi</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-600 hover:text-black">Layanan Institusional</a></li>
                    </ul>
                </div>

                <!-- Kolom 4 -->
                <div>
                    <h4 class="font-semibold text-gray-900 mb-3 text-sm">Nilai-nilai Leodra</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-600 hover:text-black">Aksesibilitas</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-black">Transparansi</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-black">Regulasi</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-black">Privasi</a></li>
                    </ul>
                </div>

                <!-- Kolom 5 -->
                <div>
                    <h4 class="font-semibold text-gray-900 mb-3 text-sm">Tentang Leodra</h4>
                    <ul class="space-y-2">
                        <li><a href="about_new.html" class="text-gray-600 hover:text-black">Newsroom</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-black">Kepemimpinan</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-black">Investor</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-black">Etika & Kepatuhan</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-black">Karier</a></li>
                        <li><a href="contact.html" class="text-gray-600 hover:text-black">Hubungi Kami</a></li>
                    </ul>
                </div>

            </div>

            <!-- Bagian Copyright Bawah -->
            <div class="mt-10 pt-6 border-t border-gray-300">
                <p class="mb-2">Perlu bantuan? Hubungi <a href="contact.html" class="text-blue-600 hover:underline">tim support</a> kami.</p>
                <div class="flex flex-col sm:flex-row justify-between sm:items-center">
                    <div class="mb-2 sm:mb-0">
                        <p>Hak Cipta Â© 2025 LEODRA. Hak cipta dilindungi undang-undang.</p>
                    </div>
                    <!-- Tautan legal untuk mobile (wrap) dan desktop (inline) -->
                    <div class="flex flex-wrap -mx-2 sm:mx-0 sm:space-x-4 my-2 sm:my-0">
                        <a href="#" class="hover:text-black px-2 sm:px-0">Kebijakan Privasi</a>
                        <span class="select-none hidden sm:inline">|</span>
                        <a href="#" class="hover:text-black px-2 sm:px-0">Ketentuan Penggunaan</a>
                        <span class="select-none hidden sm:inline">|</span>
                        <a href="#" class="hover:text-black px-2 sm:px-0">Legal</a>
                        <span class="select-none hidden sm:inline">|</span>
                        <a href="#" class="hover:text-black px-2 sm:px-0">Peta Situs</a>
                    </div>
                    <div>
                        <p>Indonesia</p>
                    </div>
                </div>
            </div>

        </div>
    </footer>
    <!-- PERUBAHAN SELESAI -->

    <script>
      // --- UI Functions ---

      // Function to toggle mobile menu
      window.toggleMobileMenu = function () {
        const mobileNavOverlay = document.getElementById("mobile-nav-overlay");
        const menuIcon = document.querySelector(".menu-icon");
        mobileNavOverlay.classList.toggle("open");
        menuIcon.classList.toggle("open");
        document.body.classList.toggle("overflow-hidden");
      };

      // Function to open the custom message modal
      window.openMessageModal = function (message) {
        const messageModal = document.getElementById("messageModal");
        const messageModalContent = document.getElementById(
          "messageModalContent"
        );
        messageModalContent.innerHTML = `<p>${message}</p>`;
        messageModal.classList.add("open");
        document.body.classList.add("overflow-hidden");
        messageModal.querySelector("button").focus();
      };

      // Function to close the custom message modal
      window.closeMessageModal = function () {
        const messageModal = document.getElementById("messageModal");
        messageModal.classList.remove("open");
        document.body.classList.remove("overflow-hidden");
      };

      // Function to handle search navigation
      window.performSearch = function (inputId) {
        const searchInput = document.getElementById(inputId);
        const query = searchInput.value.trim();
        if (query) {
          window.open(
            `https://www.google.com/search?q=${encodeURIComponent(query)}`,
            "_blank"
          );
        } else {
          openMessageModal("Silakan masukkan kata kunci pencarian.");
        }
        if (
          inputId === "mobile-search-input" &&
          document
            .getElementById("mobile-nav-overlay")
            .classList.contains("open")
        ) {
          toggleMobileMenu();
        }
      };

      // --- Authentication Functions ---

      // Fungsi untuk menangani verifikasi "dewi" (Langkah 1)
      function handlePreAuth() {
        const sandiInput = document.getElementById("pre-auth-sandi");
        const sandi = sandiInput.value.trim();
        const correctSandi = "dewi"; // Sandi yang benar

        if (sandi === correctSandi) {
          localStorage.setItem("preAuthPassed", "true"); // Tandai bahwa verifikasi berhasil
          updateLoginUI(); // Perbarui UI untuk menampilkan login PIN (Langkah 2)
        } else {
          openMessageModal("Sandi verifikasi salah.");
        }
      }
      window.handlePreAuth = handlePreAuth; // Buat global

      // Function to handle user login with a hardcoded PIN (Langkah 2)
      function loginUser() {
        const pinInput = document.getElementById("login-pin");
        const button = document.getElementById("login-button");
        const pin = pinInput.value.trim();
        const correctPin = "160110"; // The correct PIN

        if (pin.length !== 6 || !/^\d{6}$/.test(pin)) {
          openMessageModal("PIN harus terdiri dari 6 digit angka.");
          return;
        }

        button.disabled = true;
        button.textContent = "Memeriksa...";

        // Check if the PIN is correct
        if (pin === correctPin) {
          // JIKA PIN BENAR:
          localStorage.setItem("pinAuthPassed", "true");
          localStorage.removeItem("userPIN");
          updateLoginUI(); // Perbarui UI untuk menampilkan Google Login (Langkah 3)
        } else {
          // JIKA PIN SALAH:
          openMessageModal("PIN anda salah.");
          button.disabled = false;
          button.textContent = "Login";
        }
      }
      window.loginUser = loginUser; // Make it globally accessible

      /**
       * Fungsi untuk menampilkan/menyembunyikan form berdasarkan status auth.
       * Memastikan alur "dewi" -> PIN -> Google login.
       */
      function updateLoginUI() {
        try {
          const userJson = localStorage.getItem("user");
          const user = userJson ? JSON.parse(userJson) : null;
          const preAuthPassed = localStorage.getItem("preAuthPassed");
          const pinAuthPassed = localStorage.getItem("pinAuthPassed");

          // Ambil semua elemen UI
          const userInfo = document.getElementById("user-info");
          const preAuthForm = document.getElementById("pre-auth-form");
          const loginForm = document.getElementById("login-form");
          const userEmailP = document.getElementById("user-email");
          const googleOnload = document.getElementById("g_id_onload");
          const googleSignin = document.querySelectorAll(".g_id_signin");

          // Sembunyikan semua elemen Google secara default
          if (googleOnload) googleOnload.style.display = "none";
          googleSignin.forEach((el) => (el.style.display = "none"));

          if (user && user.email) {
            // 1. Jika user sudah login penuh (via Google) - Tampilkan info user
            if (userInfo) userInfo.classList.remove("hidden");
            if (preAuthForm) preAuthForm.classList.add("hidden");
            if (loginForm) loginForm.classList.add("hidden");
            if (userEmailP) userEmailP.textContent = user.email;
          } else if (pinAuthPassed) {
            // 2. Jika user lolos PIN (Siap untuk Google Login) - Tampilkan Google
            if (userInfo) userInfo.classList.add("hidden");
            if (preAuthForm) preAuthForm.classList.add("hidden");
            if (loginForm) loginForm.classList.add("hidden");
            if (googleOnload) googleOnload.style.display = "block"; // Tampilkan Google
            googleSignin.forEach((el) => (el.style.display = "inline-block"));
          } else if (preAuthPassed) {
            // 3. Jika user baru lolos "dewi" (Siap untuk PIN) - Tampilkan PIN
            if (userInfo) userInfo.classList.add("hidden");
            if (preAuthForm) preAuthForm.classList.add("hidden");
            if (loginForm) loginForm.classList.remove("hidden"); // Tampilkan login PIN
          } else {
            // 4. Jika user baru (Siap untuk "dewi") - Tampilkan "dewi"
            if (userInfo) userInfo.classList.add("hidden");
            if (preAuthForm) preAuthForm.classList.remove("hidden"); // Tampilkan pre-auth
            if (loginForm) loginForm.classList.add("hidden"); // Sembunyikan login PIN
          }
        } catch (e) {
          console.error("Error reading user from localStorage", e);
        }
      }
      window.updateLoginUI = updateLoginUI; // Buat global

      // Logout handler
      const logoutButton = document.getElementById("logout-button");
      if (logoutButton) {
        logoutButton.addEventListener("click", () => {
          localStorage.removeItem("user");
          localStorage.removeItem("token");
          localStorage.removeItem("preAuthPassed");
          localStorage.removeItem("pinAuthPassed");
          localStorage.removeItem("userPIN");
          updateLoginUI(); // Mulai ulang alur login UI
        });
      }

      // --- DOMContentLoaded Event Listener ---
      document.addEventListener("DOMContentLoaded", () => {
        // Add event listeners for 'Enter' key
        document
          .getElementById("login-pin")
          .addEventListener("keypress", (e) => {
            if (e.key === "Enter") loginUser();
          });
        const preAuthInput = document.getElementById("pre-auth-sandi");
        if (preAuthInput) {
          preAuthInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") handlePreAuth();
          });
        }
        document
          .getElementById("desktop-search-input")
          .addEventListener("keypress", (e) => {
            if (e.key === "Enter") performSearch("desktop-search-input");
          });
        document
          .getElementById("mobile-search-input")
          .addEventListener("keypress", (e) => {
            if (e.key === "Enter") performSearch("mobile-search-input");
          });

        // Intersection Observer for scroll animations
        const animateElements = document.querySelectorAll(".scroll-animate");
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("is-visible");
              } else {
                entry.target.classList.remove("is-visible");
              }
            });
          },
          { threshold: 0.1 }
        );
        animateElements.forEach((element) => observer.observe(element));

        // --- JALANKAN LOGIKA UTAMA SETELAH DOM SIAP ---
        // Panggil updateLoginUI hanya jika tidak ada token (yaitu jika belum redirect)
        if (!localStorage.getItem("token")) {
          updateLoginUI();
        }
      });
    </script>
    <script>
      /** * Fungsi ini dipanggil setelah pengguna berhasil mengklik tombol Google Login
       * dan Google mengembalikan token kredensial.
       */
      async function handleCredentialResponse(response) {
        const idToken = response.credential;
        console.log("Token Kredensial Google Diterima");

        try {
          // Kirim token ke backend untuk verifikasi
          const res = await fetch(
            "https://leodra.fiqrianandahakin.my.id/api/auth/google-sign",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ token: idToken }),
            }
          );

          const data = await res.json();
          if (res.ok && data.token) {
            localStorage.setItem("token", data.token);

            // Hapus semua status perantara (dewi, PIN) karena otentikasi penuh sudah berhasil
            localStorage.removeItem("preAuthPassed");
            localStorage.removeItem("pinAuthPassed");

            // REDIRECT LANGSUNG KE BERANDA SETELAH LOGIN GOOGLE SUKSES
            openMessageModal(
              "Login Google berhasil! Mengarahkan ke Beranda..."
            );
            setTimeout(() => {
              window.location.href = "./beranda.html";
            }, 1000);
          } else {
            openMessageModal(
              "Login gagal: " +
                (data.message || "Terjadi kesalahan pada backend.")
            );
            // Opsional: hapus token jika ada masalah
            localStorage.removeItem("token");
            localStorage.removeItem("user");
            updateLoginUI();
          }
        } catch (error) {
          console.error("Error during Google Sign-in process:", error);
          openMessageModal("Gagal menghubungkan ke server otentikasi.");
          updateLoginUI();
        }
      }
      window.handleCredentialResponse = handleCredentialResponse;
    </script>

    <script>
      // --- LOGIKA OTENTIKASI AWAL DAN REDIRECT (Pengguna lama) ---

      const token = localStorage.getItem("token");

      if (token) {
        console.log("Token ditemukan. Memverifikasi status autentikasi...");

        // Verifikasi token yang ada. Jika valid, redirect.
        fetch("https://leodra.fiqrianandahakin.my.id/api/auth/me", {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        })
          .then((res) => {
            if (res.ok) {
              // Token valid, simpan user dan arahkan ke beranda
              return res.json().then((user) => {
                localStorage.setItem("user", JSON.stringify(user));
                console.log("Autentikasi sukses. Mengarahkan ke beranda.html.");
                window.location.href = "./beranda.html";
              });
            } else {
              // Token tidak valid/kedaluwarsa, hapus dan lanjut ke login flow (dewi -> PIN -> Google)
              console.log("Token tidak valid. Lanjut ke alur login lokal.");
              localStorage.removeItem("token");
              localStorage.removeItem("user");
              // Panggil updateLoginUI setelah DOMContentLoaded untuk menghindari masalah elemen belum ada
              document.addEventListener("DOMContentLoaded", updateLoginUI);
            }
          })
          .catch((e) => {
            console.error("Error saat memeriksa token:", e);
            localStorage.removeItem("token");
            localStorage.removeItem("user");
            // Panggil updateLoginUI setelah DOMContentLoaded
            document.addEventListener("DOMContentLoaded", updateLoginUI);
          });
      }
      // Jika tidak ada token, updateLoginUI akan dipanggil oleh DOMContentLoaded listener untuk memulai alur 'dewi'.
    </script>
  </body>
</html>